<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ä¸‰æ¯›å’–å•¡ - è¨‚ä½ç³»çµ±</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@400;600;700&family=Noto+Sans+TC:wght@300;400;600;700&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { 
      font-family: 'Noto Serif TC', serif; 
      background: #000; 
      color: white; 
      min-height: 100vh; 
      padding: 40px 20px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .container { max-width: 700px; width: 100%; }
    .form-container { 
      background: white; 
      border-radius: 30px; 
      padding: 50px; 
      box-shadow: 0 20px 60px rgba(255,255,255,0.2);
    }
    .form-title { 
      font-size: 36px; 
      color: #333; 
      font-weight: 700; 
      text-align: center;
      margin-bottom: 10px;
    }
    .form-info { 
      text-align: center;
      color: #666; 
      font-family: 'Noto Sans TC', sans-serif; 
      font-size: 14px; 
      line-height: 1.8;
      margin-bottom: 40px;
    }
    .form-group { margin-bottom: 25px; }
    label { 
      display: block; 
      margin-bottom: 10px; 
      color: #333; 
      font-weight: 600; 
      font-size: 16px; 
      font-family: 'Noto Sans TC', sans-serif; 
    }
    input, select { 
      width: 100%; 
      padding: 15px 20px; 
      border: 2px solid #e5e7eb; 
      border-radius: 15px; 
      font-size: 16px; 
      font-family: 'Noto Sans TC', sans-serif; 
      transition: all 0.3s ease; 
    }
    input:focus, select:focus { 
      outline: none; 
      border-color: #000; 
      box-shadow: 0 8px 30px rgba(0,0,0,0.15); 
    }
    .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
    .guest-info { 
      display: grid; 
      grid-template-columns: repeat(3, 1fr); 
      gap: 15px; 
      padding: 20px; 
      background: #f9fafb; 
      border-radius: 15px; 
    }
    .guest-item input { text-align: center; font-weight: 600; font-size: 18px; }
    .guest-label { 
      font-size: 14px; 
      color: #666; 
      margin-bottom: 8px; 
      text-align: center; 
    }
    .warning-box { 
      background: linear-gradient(135deg, #fef3c7, #fde68a); 
      padding: 20px; 
      border-radius: 15px; 
      margin-bottom: 25px; 
      border: 2px solid #fbbf24; 
      color: #78350f; 
      font-family: 'Noto Sans TC', sans-serif; 
      line-height: 1.6; 
    }
    .time-warning { 
      background: linear-gradient(135deg, #fee2e2, #fecaca); 
      border: 2px solid #ef4444; 
      color: #991b1b; 
    }
    .submit-button { 
      width: 100%; 
      padding: 18px; 
      background: linear-gradient(135deg, #333, #000); 
      color: white; 
      border: none; 
      border-radius: 15px; 
      font-size: 18px; 
      font-weight: 600; 
      cursor: pointer; 
      font-family: 'Noto Sans TC', sans-serif; 
      box-shadow: 0 10px 30px rgba(0,0,0,0.4); 
      transition: all 0.3s ease; 
    }
    .submit-button:hover { 
      transform: translateY(-2px); 
      box-shadow: 0 12px 40px rgba(0,0,0,0.5); 
    }
    .submit-button:disabled {
      background: #ccc;
      cursor: not-allowed;
      transform: none;
    }
    .success-message { 
      text-align: center; 
      padding: 60px 20px; 
      color: #10b981; 
    }
    .success-icon { font-size: 80px; margin-bottom: 20px; }
    .hidden { display: none; }
    .loading {
      text-align: center;
      padding: 20px;
      color: #666;
    }
    .spinner {
      border: 3px solid #f3f3f3;
      border-top: 3px solid #333;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin: 0 auto 15px;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    @media (max-width: 768px) { 
      .form-container { padding: 30px; }
      .form-row { grid-template-columns: 1fr; } 
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="form-container">
      <h2 class="form-title">ä¸‰æ¯›å’–å•¡è¨‚ä½</h2>
      <div class="form-info">
        <div>ğŸ“ 07-536-5630</div>
        <div>ğŸ“ é«˜é›„å¸‚è‹“é›…å€å››ç¶­äºŒè·¯146è™Ÿ</div>
      </div>

      <form id="bookingForm" onsubmit="handleBookingSubmit(event)">
        <div class="form-group">
          <label>ğŸ‘¤ å§“å</label>
          <input type="text" id="name" required placeholder="è«‹è¼¸å…¥æ‚¨çš„å§“å">
        </div>

        <div class="form-group">
          <label>ğŸ“ é›»è©±</label>
          <input type="tel" id="phone" required placeholder="è«‹è¼¸å…¥è¯çµ¡é›»è©±">
        </div>

        <div class="form-row">
          <div class="form-group">
            <label>ğŸ“… æ—¥æœŸ</label>
            <input type="date" id="date" required>
          </div>
          <div class="form-group">
            <label>ğŸ• æ™‚é–“</label>
            <select id="time" required>
              <option value="">è«‹é¸æ“‡æ™‚é–“</option>
              <option value="11:00">11:00</option>
              <option value="11:30">11:30</option>
              <option value="12:00">12:00</option>
              <option value="12:30">12:30</option>
              <option value="13:00">13:00</option>
              <option value="13:30">13:30</option>
              <option value="14:00">14:00</option>
              <option value="14:30">14:30</option>
              <option value="15:00">15:00</option>
              <option value="15:30">15:30</option>
              <option value="16:00">16:00</option>
              <option value="16:30">16:30</option>
              <option value="17:00">17:00</option>
              <option value="17:30">17:30</option>
              <option value="18:00">18:00</option>
              <option value="18:30">18:30</option>
              <option value="19:00">19:00</option>
              <option value="19:30">19:30</option>
            </select>
          </div>
        </div>

        <div class="form-group">
          <label>ğŸ‘¥ äººæ•¸è³‡è¨Š</label>
          <div class="guest-info">
            <div class="guest-item">
              <div class="guest-label">æˆäºº</div>
              <input type="number" id="adults" value="2" min="0" required>
            </div>
            <div class="guest-item">
              <div class="guest-label">ğŸ‘¶ å°å­©</div>
              <input type="number" id="children" value="0" min="0" onchange="checkChildren()">
            </div>
            <div class="guest-item">
              <div class="guest-label">ğŸ• å¯µç‰©</div>
              <input type="number" id="pets" value="0" min="0">
            </div>
          </div>
        </div>

        <div id="timeWarning" class="warning-box time-warning hidden">
          <strong>â° ç•¶æ—¥è¨‚ä½æé†’</strong><br>
          æŠ±æ­‰ï¼Œç•¶æ—¥è¨‚ä½åƒ…æ¥å—æ—©ä¸Š 7:00 å‰çš„é è¨‚ã€‚å¦‚éœ€ç•¶æ—¥è¨‚ä½ï¼Œè«‹ç›´æ¥ä¾†é›»ï¼š07-536-5630
        </div>

        <div id="childrenWarning" class="warning-box hidden">
          <strong>âš ï¸ æº«é¦¨æé†’</strong><br>
          æ‚¨çš„è¨‚ä½åŒ…å«å…’ç«¥ï¼Œåˆ°åº—å¾Œéœ€å¡«å¯«<strong>ã€Œä¹–ä¹–ä¿è­‰æ›¸ã€</strong>ï¼Œç¢ºä¿ç”¨é¤å“è³ªèˆ‡å®‰å…¨ã€‚æ„Ÿè¬æ‚¨çš„é…åˆï¼
        </div>

        <button type="submit" class="submit-button" id="submitBtn">ç¢ºèªè¨‚ä½ â†’</button>
      </form>

      <div id="loadingMessage" class="loading hidden">
        <div class="spinner"></div>
        <p>æ­£åœ¨è™•ç†è¨‚ä½...</p>
      </div>

      <div id="successMessage" class="success-message hidden">
        <div class="success-icon">âœ“</div>
        <h3 style="font-size: 28px; margin-bottom: 15px; font-weight: 600;">è¨‚ä½æˆåŠŸï¼</h3>
        <p style="font-size: 18px; margin-bottom: 20px; color: #333;">æ„Ÿè¬æ‚¨çš„é è¨‚ï¼æˆ‘å€‘å·²æ”¶åˆ°æ‚¨çš„è¨‚ä½è³‡è¨Šä¸¦ç™¼é€é€šçŸ¥çµ¦åº—å®¶ã€‚</p>
        <div style="font-size: 14px; color: #666;">
          è¨‚ä½ç·¨è™Ÿï¼š<span id="bookingId" style="font-weight: 600; color: #333;"></span>
        </div>
      </div>
    </div>
  </div>

  <script>
    const API_URL = 'https://script.google.com/macros/s/AKfycbxsBXgPzfhIqXxBq9XGX-K_JusuqrIHS8C9TJRs8caKRb67EshOIVJz4Ec41cRpCe07/exec';
    const CLOSED_DATES = ['2026-01-01', '2026-01-06'];

    document.addEventListener('DOMContentLoaded', function() {
      const dateInput = document.getElementById('date');
      const today = new Date();
      
      dateInput.min = today.toISOString().split('T')[0];
      
      const maxDate = new Date();
      maxDate.setDate(today.getDate() + 30);
      dateInput.max = maxDate.toISOString().split('T')[0];
      
      dateInput.addEventListener('change', checkDateAndTime);
      
      console.log('âœ… ä¸‰æ¯›å’–å•¡è¨‚ä½ç³»çµ±å·²è¼‰å…¥');
      console.log('ğŸ“¡ API:', API_URL);
    });

    function isClosedDate(dateStr) {
      return CLOSED_DATES.includes(dateStr);
    }

    function checkChildren() {
      const children = parseInt(document.getElementById('children').value) || 0;
      const warning = document.getElementById('childrenWarning');
      if (children > 0) {
        warning.classList.remove('hidden');
      } else {
        warning.classList.add('hidden');
      }
    }

    function checkDateAndTime() {
      const selectedDate = document.getElementById('date').value;
      const timeWarning = document.getElementById('timeWarning');
      const submitBtn = document.getElementById('submitBtn');
      
      if (!selectedDate) return true;
      
      const today = new Date();
      const currentHour = today.getHours();
      const isToday = today.toISOString().split('T')[0] === selectedDate;
      
      if (isToday && currentHour >= 7) {
        timeWarning.classList.remove('hidden');
        submitBtn.disabled = true;
        submitBtn.textContent = 'ç•¶æ—¥è¨‚ä½å·²æˆªæ­¢';
        return false;
      } else {
        timeWarning.classList.add('hidden');
        submitBtn.disabled = false;
        submitBtn.textContent = 'ç¢ºèªè¨‚ä½ â†’';
      }
      
      return true;
    }

    async function handleBookingSubmit(event) {
      event.preventDefault();
      
      const selectedDate = document.getElementById('date').value;
      
      if (isClosedDate(selectedDate)) {
        alert('æŠ±æ­‰ï¼Œ' + selectedDate + ' ç‚ºå…¬ä¼‘æ—¥ï¼Œç„¡æ³•è¨‚ä½ã€‚');
        return;
      }
      
      if (!checkDateAndTime()) {
        return;
      }
      
      const submitBtn = document.getElementById('submitBtn');
      const form = document.getElementById('bookingForm');
      const loadingMsg = document.getElementById('loadingMessage');
      const successMsg = document.getElementById('successMessage');
      
      submitBtn.disabled = true;
      form.classList.add('hidden');
      loadingMsg.classList.remove('hidden');
      
      const booking = {
        id: Date.now(),
        name: document.getElementById('name').value,
        phone: document.getElementById('phone').value,
        date: selectedDate,
        time: document.getElementById('time').value,
        adults: parseInt(document.getElementById('adults').value),
        children: parseInt(document.getElementById('children').value),
        pets: parseInt(document.getElementById('pets').value),
        status: 'pending',
        createdAt: new Date().toISOString()
      };
      
      console.log('ğŸ“ é€å‡ºè¨‚ä½:', booking);
      
      try {
        const response = await fetch(API_URL, {
          method: 'POST',
          mode: 'no-cors',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            action: 'create',
            booking: booking
          })
        });
        
        // no-cors æ¨¡å¼ä¸‹ç„¡æ³•è®€å–å›æ‡‰ï¼Œä½†å¦‚æœæ²’æœ‰éŒ¯èª¤å°±ç•¶ä½œæˆåŠŸ
        console.log('âœ… è¨‚ä½å·²é€å‡ºï¼ˆno-cors æ¨¡å¼ï¼‰');
        console.log('ğŸ“§ Email é€šçŸ¥å°‡ç™¼é€åˆ° 3maocafe@gmail.com');
        
        loadingMsg.classList.add('hidden');
        successMsg.classList.remove('hidden');
        document.getElementById('bookingId').textContent = '#' + booking.id;
        
        setTimeout(() => {
          form.classList.remove('hidden');
          successMsg.classList.add('hidden');
          form.reset();
          document.getElementById('adults').value = 2;
          document.getElementById('children').value = 0;
          document.getElementById('pets').value = 0;
          checkChildren();
          checkDateAndTime();
          submitBtn.disabled = false;
        }, 3000);
        
      } catch (error) {
        console.error('âŒ è¨‚ä½éŒ¯èª¤:', error);
        loadingMsg.classList.add('hidden');
        form.classList.remove('hidden');
        submitBtn.disabled = false;
        alert('è¨‚ä½å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦æˆ–ç›´æ¥ä¾†é›»ï¼š07-536-5630\n\néŒ¯èª¤è¨Šæ¯ï¼š' + error.message);
      }
    }
  </script>
</body>
</html>
